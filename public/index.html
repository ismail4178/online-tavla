<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Online Tavla</title>
<script src="/socket.io/socket.io.js"></script>

<style>
@media (orientation: portrait) {
  body::before {
    content: "Telefonu yatay çevir";
    position: fixed;
    inset: 0;
    background: #000;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9;
    font-size: 22px;
  }
}
body { margin:0; font-family:Arial; background:#0f172a; color:#fff }
button,input { padding:12px; font-size:16px; border-radius:8px; border:none; margin:5px }

#menu,#game {
  height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}

#board {
  display:grid;
  grid-template-columns:repeat(12,1fr);
  grid-template-rows:1fr 1fr;
  width:100%;
  height:70vh;
  background:#1e3a5f;
  padding:8px;
}

.point { display:flex; flex-direction:column; align-items:center }
.point.bottom { justify-content:flex-end }

.stone {
  width:26px;
  height:26px;
  border-radius:50%;
  margin:2px;
}
.white { background:#f8fafc }
.black { background:#020617 }

#dice { display:flex; gap:10px; margin:10px }
.die {
  width:40px;
  height:40px;
  background:#fff;
  color:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  border-radius:8px;
}
</style>
</head>

<body>

<div id="menu">
  <h2>Online Tavla</h2>
  <input id="nick" placeholder="Nickname">
  <input id="roomCode" placeholder="Oda Kodu">
  <button onclick="createRoom()">Oda Kur</button>
  <button onclick="joinRoom()">Odaya Katıl</button>
</div>

<div id="game" style="display:none">
  <h3 id="players"></h3>
  <div id="dice">
    <div class="die" id="d1">-</div>
    <div class="die" id="d2">-</div>
    <button onclick="roll()">Zar At</button>
  </div>
  <div id="board"></div>
</div>

<script>
const socket = io();
let currentRoom = "";

function createRoom() {
  if (!nick.value) return alert("Nick gir");
  socket.emit("createRoom", nick.value);
}

function joinRoom() {
  if (!nick.value || !roomCode.value) return alert("Eksik bilgi");
  currentRoom = roomCode.value.toUpperCase();
  socket.emit("joinRoom", { code: currentRoom, nick: nick.value });
}

socket.on("roomCreated", (code) => {
  currentRoom = code;
  alert("Oda Kodu: " + code);
});

socket.on("startGame", (players) => {
  menu.style.display = "none";
  game.style.display = "flex";
  document.getElementById("players").innerText =
    players.map(p => p.nick).join(" vs ");
  drawBoard();
});

function roll() {
  socket.emit("rollDice", currentRoom);
}

socket.on("diceResult", (d) => {
  d1.innerText = d.d1;
  d2.innerText = d.d2;
});

socket.on("errorMsg", msg => alert(msg));

function drawBoard() {
  board.innerHTML = "";
  for (let i = 0; i < 24; i++) {
    const p = document.createElement("div");
    p.className = "point " + (i >= 12 ? "bottom" : "");
    if (i === 0 || i === 23) {
      for (let j = 0; j < 5; j++) {
        const s = document.createElement("div");
        s.className = "stone " + (i === 0 ? "white" : "black");
        p.appendChild(s);
      }
    }
    board.appendChild(p);
  }
}
</script>

</body>
</html>
